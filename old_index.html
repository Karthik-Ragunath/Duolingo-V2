<!DOCTYPE html>
<html>
<head>
    <title>Video Call with Live Utterances</title>
    <style>
        body { margin: 0; font-family: sans-serif; display: flex; height: 100vh; }
        #left-pane { flex: 1; padding: 10px; border-right: 1px solid #ccc; display: flex; flex-direction: column; overflow-y: auto; }
        #right-pane { flex: 1; padding: 10px; display: flex; flex-direction: column; overflow-y: auto; }
        #utterances-content { flex-grow: 1; overflow-y: auto; border: 1px solid #eee; padding: 5px; }
        #utterances-content p { margin: 0 0 5px 0; padding: 3px; border-bottom: 1px dotted #f0f0f0; }
        #utterances-content p:last-child { border-bottom: none; }
        iframe { width: 100%; border: none; }
    </style>
</head>
<body>
    <div id="left-pane">
        <h2>Video Call</h2>
        <iframe src="https://tavus.daily.co/c61a2e743cc4" height="800" title="Iframe Example" allow="camera; microphone"></iframe>
    </div>
    <div id="right-pane">
        <h2>Live Utterances</h2>
        <div id="utterances-content">
            <p>Waiting for utterances...</p>
        </div>
    </div>

    <script>
        const utterancesDiv = document.getElementById('utterances-content');
        // Ensure this URL matches where your Python SSE endpoint will run
        const eventSource = new EventSource('http://localhost:5001/listen-utterances');
        console.log("eventSource: ", eventSource)
        <!-- eventSource.onopen = function() {
            console.log("Connected to utterance stream.");
            const waitingMsg = utterancesDiv.querySelector('p');
            if (waitingMsg && waitingMsg.textContent === "Waiting for utterances...") {
                // Optionally, change message to indicate connection established
                // waitingMsg.textContent = "Connected. Waiting for utterances...";
            }
        };

        eventSource.onmessage = function(event) {
            // Clear "Waiting" message on first actual utterance
            console.log("on message activated")
            const waitingMsg = utterancesDiv.querySelector('p');
            if (waitingMsg && (waitingMsg.textContent.startsWith("Waiting for utterances...") || waitingMsg.textContent.startsWith("Connected."))) {
                utterancesDiv.innerHTML = ''; // Clear initial message
            }

            const newUtterance = document.createElement('p');
            newUtterance.textContent = event.data;
            console.log("newUtterance: ", newUtterance.textContent);
            // Prepend to see latest utterances at the top
            utterancesDiv.insertBefore(newUtterance, utterancesDiv.firstChild);
        };

        eventSource.onerror = function(err) {
            console.error("EventSource failed:", err);
            const errorMsg = document.createElement('p');
            errorMsg.textContent = "Error connecting to utterance stream. Is the Python script running and serving on port 5001?";
            errorMsg.style.color = "red";

            // Clear existing messages and show only the error
            utterancesDiv.innerHTML = '';
            utterancesDiv.appendChild(errorMsg);
            // eventSource.close(); // You might want to close if errors are persistent
        }; -->

        eventSource.onopen = function() {
            console.log("EVENTSOURCE: Connection opened."); // Changed log for clarity
            // ... your existing onopen logic ...
        };

        // TEMPORARILY SIMPLIFIED
        eventSource.onmessage = function(event) {
            console.log("EVENTSOURCE: Message received! Data:", event.data);
            // alert("Message received: " + event.data); // You could even try an alert for a very obvious indication
        };

        eventSource.onerror = function(err) {
            console.error("EVENTSOURCE: Error occurred:", err);
            // ... your existing onerror logic ...
        };
    </script>
</body>
</html>